<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>病害虫アンケート</title>
    <style>
      body{ width: 100vw; height: 100vh; display: flex; flex-direction: row;
           background-color: #ffeeee; width: 50%; display: flex; flex-direction: column; align-items: center; justify-content: start; }
    </style>
    <script>
      function OnPost(){

        const URL = "https://script.google.com/macros/s/AKfycbwpkrK9uFXvxf-6Nr5lDElbEb2g9HjqnqgLvCoxRlM8m2K8AMMK48bfrbKga03BVuq5/exec";
                    //↑GASで取得したスプレッドシートのURL
        let SendDATA = {
          "column_1" : document.getElementById("column_1").value,
          "column_2" : document.getElementById("column_2").value,
          "column_3" : document.getElementById("column_3").value,
          "column_4" : document.getElementById("column_4").value 　
          //column_4だと上3つのデータもスプレッドシートへいかなくなってしまうのでとりあえず変えました。
        };
        let postparam = {
          "method" : "POST",
          "mode" : "no-cors",
          "Content-Type" : "application/x-www-form-urlencoded",
          "body" : JSON.stringify(SendDATA)
        };
        fetch(URL, postparam);
      }

    </script>
    <script>

    var options = {
      enableHighAccuracy: true,
      timeout: 1000,
      maximumAge: 0
    };

    function getLocationPromise () {
        return new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, options);
        });
    }

    function error(err) {
      console.warn(`ERROR(${err.code}): ${err.message}`);
    }

    async function spot (){
        console.time('time to get location');

        const position = await getLocationPromise();
        console.log('position:',position);

        document.getElementById("lat").innerHTML = 'Lat: ' + position.coords.latitude;
        document.getElementById("lng").innerHTML = 'Lng: ' + position.coords.longitude;
        document.getElementById("acc").innerHTML = 'Accuracy of position: ' + position.coords.accuracy;
        document.getElementById("alt").innerHTML = 'Altitude: ' + position.coords.altitude;
        document.getElementById("altAcc").innerHTML = 'Altitude Accuracy: ' + position.coords.altitudeAccuracy;
        document.getElementById("heading").innerHTML = 'Heading: ' + position.coords.heading;
        document.getElementById("speed").innerHTML = 'Speed: ' + position.coords.speed;
        document.getElementById("timestamp").innerHTML = 'Timestamp: ' + position.timestamp;

        console.timeEnd('time to get location');
    }

    </script>

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css" rel="stylesheet">
  </head>
  <body>
    <div id="left">
      <h1>病害虫アンケート</h1>
      <p>病害虫名</p>
      <select class="chosen-select" id="column_1">
        <option value="">入力してください</option>
        <option value="ハエ">ハエ</option>
        <option value="へび">蛇</option>
        <option value="か">蚊</option>
        <option value="いもり">イモリ</option>
        <option value="いのしし">イノシシ</option>
        <option value="その他">その他</option>
      </select>  
      <script>
          $('.chosen-select').chosen();
        </script>
      <p>備考(任意)</p>
      <input type="text" id="column_2">
      <p>電話番号(任意)</p>
      <input type="text" id="column_3">

      <p>位置情報</p>
      <div class="flex-container">
          <button class="center waves-effect waves-light btn blue" onclick="spot()">Get Location</button>
          <input type=""id="column_4">
      </div>
      <div class="output" id="column_4">
          <div id="lat"></div>
          <div id="lng"></div>

      </div>


        <button style="margin-top: 20px;" onclick="OnPost();">送信</button>



    </div>

  </body>
</html>
